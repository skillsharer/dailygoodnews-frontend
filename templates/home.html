<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'header.html' %}
    <title>Daily Good News</title>
    <style>
        /* Prevent FOUC */
        html, body {
            margin: 0;
            padding: 0;
        }
        body {
            opacity: 0; /* Hide body content initially */
             transition: opacity 0.2s ease; /* Add transition for smoother fade in*/
           
        }

         #loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            background: #fff;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
        }

        .loader-spinner {
            border: 6px solid rgba(129, 199, 212, 0.1);
            border-top: 6px solid #81c7d4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            box-shadow: 0 4px 15px rgba(129, 199, 212, 0.2);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
     <script>
        // Inline script to set opacity to 1 and handle hero section
        document.addEventListener("DOMContentLoaded", function() {
             document.body.style.opacity = '1';
        });
        
        // Immediately hide hero if user has seen it before - prevent layout shift
        if (sessionStorage.getItem('hasVisitedSession')) {
            document.write('<style>#hero-section{display:none !important;} #main-content{opacity:1 !important;transform:translateY(0) !important; padding-top:100px !important;} .featured-news{margin-top:120px !important;}</style>');
        }
     </script>
</head>
<body>
    <div id="loader">
        <div class="loader-spinner"></div>
    </div>
    <div id="hero-section" class="parallax">
        <div class="hero-overlay">
            <h1 class="hero-title">Discover the Good in Every Day</h1>
            <p class="hero-subtitle">Because what you consume really does matter</p>
            <a href="#main-content" class="cta-button" id="explore-now">Explore Now</a>
        </div>
    </div>
    <div id="main-content">
        <section class="featured-news">
            <h2 class="section-title">Top Stories</h2>
            <div class="news-grid" id="news-grid">
                {% for news in news_list %}
                <article class="news-card" data-index="{{ loop.index0 }}">
                    <a href="/news/{{ news.slug }}" class="news-card-link">
                        <div class="image-wrapper">
                            {% if news.image %}
                                <img src="{{ news.image }}" alt="{{ news.heading }}" class="news-card-image">
                            {% endif %}
                            <div class="news-card-content">
                                <h3 class="news-card-title">{{ news.heading }}</h3>
                                {% if news.image %}
                                    <div class="news-card-description">{{ news.article|sanitize_html|safe|truncate(200) }}</div>
                                {% else %}
                                    <div class="news-card-description">{{ news.article|sanitize_html|safe|truncate(400) }}</div>
                                {% endif %}
                                <div class="read-more">Read More</div>
                            </div>
                        </div>
                    </a>
                </article>
                {% endfor %}
            </div>
            {% if news_list|length > 2 %}
            <div class="view-more-container">
                <button id="view-more-btn" class="view-more-btn">
                    View More Stories
                    <span class="view-more-icon">â†“</span>
                </button>
            </div>
            {% endif %}
        </section>
        <!--
        <section class="newsletter-signup">
            <h2>Stay Updated</h2>
            <p>Subscribe to our newsletter for the latest uplifting stories</p>
            <form class="signup-form">
                <input type="email" placeholder="Enter your email" required class="email-input">
                <button type="submit" class="subscribe-button">Subscribe</button>
            </form>
        </section>
        -->
    </div>
    {% include 'footer.html' %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const loader = document.getElementById('loader');
            const exploreButton = document.getElementById("explore-now");
            const targetSection = document.getElementById("main-content");
            const header = document.querySelector('.site-header');
            const menuToggle = document.querySelector('.menu-toggle');
            const nav = document.querySelector('.main-nav');
            const footer = document.querySelector('footer');
            const heroSection = document.getElementById('hero-section');
            // Check if the user has visited during the current session
            const hasVisitedSession = sessionStorage.getItem('hasVisitedSession');
            if (hasVisitedSession) {
                // For return visitors, hero is already hidden via inline CSS
                heroSection.classList.add('hidden');
                targetSection.classList.add('visible');
                
                // No scrolling or positioning - prevent navigation jumps
                // Content is properly positioned via CSS
            } else {
                // Mark as visited when they interact with the page
                sessionStorage.setItem('hasVisitedSession', 'true');
                // Only add scroll listener for first-time visitors
                window.addEventListener("scroll", handleScroll);
            }
            loader.style.display = 'none';

            function handleScroll() {
                const sectionPosition = targetSection.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;
                const scrollY = window.scrollY;

                // Header scroll effect
                if(scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }

                // Only handle hero hiding if hero is still visible
                if (!heroSection.classList.contains('hidden')) {
                    if (scrollY > windowHeight * 0.3) {
                        heroSection.classList.add('hidden');
                        // Remove this scroll listener once hero is hidden
                        window.removeEventListener("scroll", handleScroll);
                    }
                }

                // Show main content when it comes into view
                if (sectionPosition < windowHeight) {
                    targetSection.classList.add("visible");
                }
                
                // Footer visibility
                if (footer && footer.getBoundingClientRect().top < windowHeight) {
                    footer.classList.add('visible');
                }
            }

            function customSmoothScroll(target, duration) {
                const startPosition = window.pageYOffset;
                // Better positioning for the highlighted news card
                const offset = target.classList.contains('news-card') ? 150 : 100;
                const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
                const distance = targetPosition - startPosition;
                let startTime = null;

                function animation(currentTime) {
                    if (startTime === null) {
                        startTime = currentTime;
                    }
                    const timeElapsed = currentTime - startTime;
                    const run = easeInOutQuad(timeElapsed, startPosition, distance, duration);
                    window.scrollTo(0, run);
                    if (timeElapsed < duration) {
                        requestAnimationFrame(animation);
                    }
                }
                requestAnimationFrame(animation);
            }

            function easeInOutQuad(t, b, c, d) {
                t /= d/2;
                if (t < 1) return c/2*t*t + b;
                t--;
                return -c/2 * (t*(t-2) - 1) + b;
            }

            exploreButton.addEventListener("click", function (e) {
                e.preventDefault();
                
                // Start the transition
                heroSection.classList.add("hidden");
                targetSection.classList.add("visible");
                
                // Wait for hero to hide, then position at the highlighted story
                setTimeout(() => {
                    const sectionTitle = document.querySelector('.section-title');
                    if (sectionTitle) {
                        // Position to show the "Top Stories" title and the highlighted first card
                        const titlePosition = sectionTitle.getBoundingClientRect().top + window.pageYOffset - 120;
                        window.scrollTo({
                            top: titlePosition,
                            behavior: 'smooth'
                        });
                    }
                    window.removeEventListener("scroll", handleScroll);
                }, 500);
            });

            menuToggle.addEventListener('click', function() {
                menuToggle.classList.toggle('active');
                nav.classList.toggle('active');
            });

            // Pagination is handled by external pagination.js file
        });
    </script>
    
    <!-- Dynamic Pagination System -->
    <script src="{{ url_for('static', filename='js/pagination.js') }}"></script>
</body>
</html>