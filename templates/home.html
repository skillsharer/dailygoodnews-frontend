{% extends "base.html" %}

{% block title %}Daily Good News{% endblock %}

{% block extra_css %}
<style>
    /* Home-specific hero section styles - prevent layout shift */
    #hero-section.hidden {
        display: none !important;
        transition: opacity 0.3s ease;
    }
    
    #main-content.visible {
        opacity: 1 !important;
        transform: translateY(0) !important;
        padding-top: 100px !important;
    }
    
    .featured-news.shifted {
        margin-top: 120px !important;
    }
    
    /* Smooth highlight effect for first news card */
    .news-card:first-child {
        position: relative;
        z-index: 1;
    }
    
    /* Remove conflicting smooth scroll behavior */
</style>
{% endblock %}

{% block content %}
    <div id="hero-section" class="parallax">
        <div class="hero-overlay">
            <h1 class="hero-title">Discover the Good in Every Day</h1>
            <p class="hero-subtitle">Because what you consume really does matter</p>
            <a href="#" class="cta-button" id="explore-now">Explore Now</a>
        </div>
    </div>
    <div id="main-content">
        <section class="featured-news">
            <h2 class="section-title">Top Stories</h2>
            <div class="news-grid" id="news-grid">
                {% for news in news_list %}
                <article class="news-card" data-index="{{ loop.index0 }}">
                    <a href="/news/{{ news.slug }}" class="news-card-link">
                        <div class="image-wrapper">
                            {% if news.image %}
                                <img src="{{ news.image }}" alt="{{ news.heading }}" class="news-card-image">
                            {% endif %}
                            <div class="news-card-content">
                                <h3 class="news-card-title">{{ news.heading }}</h3>
                                {% if news.image %}
                                    <div class="news-card-description">{{ news.article|sanitize_html|safe|truncate(200) }}</div>
                                {% else %}
                                    <div class="news-card-description">{{ news.article|sanitize_html|safe|truncate(400) }}</div>
                                {% endif %}
                                <div class="read-more">Read More</div>
                            </div>
                        </div>
                    </a>
                </article>
                {% endfor %}
            </div>
            {% if news_list|length > 2 %}
            <div class="view-more-container">
                <button id="view-more-btn" class="view-more-btn">
                    View More Stories
                    <span class="view-more-icon">â†“</span>
                </button>
            </div>
            {% endif %}
        </section>
        <!--
        <section class="newsletter-signup">
            <h2>Stay Updated</h2>
            <p>Subscribe to our newsletter for the latest uplifting stories</p>
            <form class="signup-form">
                <input type="email" placeholder="Enter your email" required class="email-input">
                <button type="submit" class="subscribe-button">Subscribe</button>
            </form>
        </section>
        -->
    </div>

{% endblock %}

{% block extra_js %}
<script>
        document.addEventListener("DOMContentLoaded", function () {
            const loader = document.getElementById('loader');
            const exploreButton = document.getElementById("explore-now");
            const targetSection = document.getElementById("main-content");
            const header = document.querySelector('.site-header');
            const menuToggle = document.querySelector('.menu-toggle');
            const nav = document.querySelector('.main-nav');
            const footer = document.querySelector('footer');
            const heroSection = document.getElementById('hero-section');
            // Check if the user has visited during the current session
            const hasVisitedSession = sessionStorage.getItem('hasVisitedSession');
            if (hasVisitedSession) {
                // For return visitors, hero is already hidden via inline CSS
                heroSection.classList.add('hidden');
                targetSection.classList.add('visible');
                
                // No scrolling or positioning - prevent navigation jumps
                // Content is properly positioned via CSS
            } else {
                // Mark as visited when they interact with the page
                sessionStorage.setItem('hasVisitedSession', 'true');
                // Only add scroll listener for first-time visitors
                window.addEventListener("scroll", handleScroll);
            }
            loader.style.display = 'none';

            function handleScroll() {
                const sectionPosition = targetSection.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;
                const scrollY = window.scrollY;

                // Header scroll effect
                if(scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }

                // Only handle hero hiding if hero is still visible
                if (!heroSection.classList.contains('hidden')) {
                    if (scrollY > windowHeight * 0.3) {
                        heroSection.classList.add('hidden');
                        // Remove this scroll listener once hero is hidden
                        window.removeEventListener("scroll", handleScroll);
                    }
                }

                // Show main content when it comes into view
                if (sectionPosition < windowHeight) {
                    targetSection.classList.add("visible");
                }
                
                // Footer visibility handling removed to prevent color bugs
            }

            // Very smooth easing function for gentle deceleration
            function easeOutQuart(t) {
                return 1 - Math.pow(1 - t, 4);
            }

            function customSmoothScroll(target, duration = 1200) {
                const startPosition = window.pageYOffset;
                let targetPosition;
                
                // Handle both element targets and position objects
                if (typeof target === 'object' && target.getBoundingClientRect) {
                    const rect = target.getBoundingClientRect();
                    targetPosition = rect.top + window.pageYOffset;
                } else if (typeof target === 'number') {
                    targetPosition = target;
                } else {
                    const offset = target.classList && target.classList.contains('news-card') ? 150 : 100;
                    targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
                }
                
                const distance = targetPosition - startPosition;
                let startTime = null;

                function animation(currentTime) {
                    if (startTime === null) {
                        startTime = currentTime;
                    }
                    const timeElapsed = currentTime - startTime;
                    const run = easeInOutCubic(timeElapsed, startPosition, distance, duration);
                    window.scrollTo(0, run);
                    if (timeElapsed < duration) {
                        requestAnimationFrame(animation);
                    }
                }
                requestAnimationFrame(animation);
            }

            // Smoother easing function for more natural scroll
            function easeInOutCubic(t, b, c, d) {
                t /= d/2;
                if (t < 1) return c/2*t*t*t + b;
                t -= 2;
                return c/2*(t*t*t + 2) + b;
            }

            exploreButton.addEventListener("click", function (e) {
                e.preventDefault();
                
                // Mark as visited for session
                sessionStorage.setItem('hasVisitedSession', 'true');
                
                // First, immediately hide hero and show content to finalize layout
                heroSection.style.transition = 'opacity 1.2s ease-out, transform 1.2s ease-out';
                heroSection.style.opacity = '0';
                heroSection.style.transform = 'translateY(-50px) scale(0.95)';
                
                // Show main content immediately
                targetSection.classList.add("visible");
                
                // Fully hide hero quickly to stabilize layout before scrolling
                setTimeout(() => {
                    heroSection.classList.add("hidden");
                    
                    // Ensure footer maintains proper styling
                    if (footer) {
                        footer.style.background = 'linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%)';
                        footer.style.color = 'rgba(255, 255, 255, 0.95)';
                    }
                    
                    // Now that layout is stable, calculate and scroll to correct position
                    setTimeout(() => {
                        const firstNewsCard = document.querySelector('.news-card:first-child');
                        const sectionTitle = document.querySelector('.section-title');
                        
                        if (firstNewsCard && sectionTitle) {
                            // Calculate position based on final layout (hero is now gone)
                            const titleRect = sectionTitle.getBoundingClientRect();
                            const scrollTarget = window.pageYOffset + titleRect.top - 120;
                            
                            window.scrollTo({
                                top: scrollTarget,
                                behavior: 'smooth'
                            });
                            
                            // Highlight first news card after scroll settles
                            setTimeout(() => {
                                firstNewsCard.style.transform = 'translateY(-4px) scale(1.02)';
                                firstNewsCard.style.boxShadow = '0 12px 40px rgba(129, 199, 212, 0.25)';
                                firstNewsCard.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                                
                                setTimeout(() => {
                                    firstNewsCard.style.transform = '';
                                    firstNewsCard.style.boxShadow = '';
                                    
                                    // Ensure footer styling is still correct after all animations
                                    if (footer) {
                                        footer.style.background = 'linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%)';
                                        footer.style.color = 'rgba(255, 255, 255, 0.95)';
                                    }
                                }, 3000);
                            }, 600);
                        }
                    }, 50);
                }, 300);
                
                window.removeEventListener("scroll", handleScroll);
            });

            menuToggle.addEventListener('click', function() {
                menuToggle.classList.toggle('active');
                nav.classList.toggle('active');
            });

            // Pagination is handled by external pagination.js file
        });
        
        // Home-specific hero section behavior
        if (sessionStorage.getItem('hasVisitedSession')) {
            document.documentElement.style.setProperty('--hero-display', 'none');
            document.documentElement.style.setProperty('--main-content-opacity', '1');
            document.documentElement.style.setProperty('--main-content-transform', 'translateY(0)');
            document.documentElement.style.setProperty('--main-content-padding', '100px');
            document.documentElement.style.setProperty('--featured-news-margin', '120px');
        }
    </script>

{% endblock %}